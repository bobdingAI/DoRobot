# ===========================================================================
# DORA Distributed Dataflow for SO101 Robot
# ===========================================================================
#
# This dataflow is for DISTRIBUTED TELEOPERATION mode where:
# - Leader arm is on a REMOTE PC (connected via Zenoh)
# - Follower arm and cameras are LOCAL
#
# Usage:
#   ZENOH_LEADER_ENDPOINT=tcp://10.0.0.102:7447 bash scripts/run_so101.sh
#
# The Python manipulator receives leader data via Zenoh and forwards
# it to the follower arm via ZeroMQ (action_joint_ctrl).
#
# ===========================================================================

nodes:
  - id: camera_top
    path: ../../components/camera_opencv/main.py
    inputs:
      tick: dora/timer/millis/33
    outputs:
      - image
    env:
      CAPTURE_PATH: $CAMERA_TOP_PATH
      IMAGE_WIDTH: 640
      IMAGE_HEIGHT: 480

  - id: camera_wrist
    path: ../../components/camera_opencv/main.py
    inputs:
      tick: dora/timer/millis/33
    outputs:
      - image
    env:
      CAPTURE_PATH: $CAMERA_WRIST_PATH
      IMAGE_WIDTH: 640
      IMAGE_HEIGHT: 480

  # NO local leader arm - leader data comes via Zenoh from remote PC

  - id: arm_so101_follower
    path: ../../components/arm_normal_so101_v1/main.py
    inputs:
      get_joint: dora/timer/millis/33
      # In distributed mode, actions come from ZeroMQ (forwarded from Zenoh)
      action_joint_ctrl: so101_zeromq/action_joint
    outputs:
      - joint
    env:
      GET_DEVICE_FROM: PORT
      PORT: $ARM_FOLLOWER_PORT
      ARM_NAME: SO101-follower
      ARM_ROLE: follower
      CALIBRATION_DIR: ../../components/arm_normal_so101_v1/.calibration/

  - id: so101_zeromq
    path: dora_zeromq.py
    inputs:
      image_top: camera_top/image
      image_wrist: camera_wrist/image
      # No leader joint input - comes via Zenoh instead
      main_follower_joint: arm_so101_follower/joint
    outputs:
      - action_joint
